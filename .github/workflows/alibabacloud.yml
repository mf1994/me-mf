name: Build app and deploy to aliyun
on:
  push:
    branches: [ main ] #当push代码到main分支时会自动触发action
    
jobs:
  build:
    runs-on: ubuntu-latest        # github分配的运行平台，无需更改
    steps:  # 某个任务的一系列步骤,如前端需要安装依赖，编译打包代码等等
      - uses: actions/checkout@v2     #使用action库 actions/checkout获取源码，执行你的操作
        with:
          persist-credentials: false
          ref: main
          submodules: true
          
       #安装依赖
      - name: install 
        run: npm i
       #打包
      - name: build
        run: npm run build
       # 使用Upload-File-Action库上传打包文件到远程服务器
      - name: 上传文件到远程服务器
        uses: zhenyuWang/Upload-File-Action@v1.0.1
        with:
          username: "root" #远程服务器的登录名
          server: "112.74.162.97" #远程服务器的ip地址
          port: "22" #远程服务器的端口
          ssh_private_key: ${{ secrets.SERVER_SSH_KEY}} #远程服务器的私钥
          # 要上传文件所在目录
          local_path: "./build"
          # 远程服务器目标路径
          target_path: "/root/project/mf-me"
